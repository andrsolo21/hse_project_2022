%!TEX TS-program = xelatex
\documentclass[a4paper,14pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\input{data/preambular.tex}
\usepackage[fixlanguage]{babelbib}
\usepackage{lastpage}
\begin{document}

    \input{data/title.tex}

    \section*{\hfill СПИСОК ИСПОЛНИТЕЛЕЙ \hfill}
    \newpage
    
    \section*{\hfill РЕФЕРАТ \hfill}
    
    Расчетно-пояснительная записка \pageref{LastPage} с., 00 рис., 00 табл., 00 источников, 00 прил.
    
    КЛЮЧЕВЫЕ СЛОВА: ГРАФ, ГОМОФИЛИЯ, ГЕТОРОФИЛИЯ, GNN, КЛАССИФИКАЦИЯ, МЕТРИКА КАЧЕСТВА КЛАССИФИКАЦИИ, МЕТРИКА ГОМОФИЛИИ 
    
    \textbf{Объектом исследования в  НИР} являются метрики оценки гомофилии и качества классификации для графовых нейронных сетей для графов, подходящие для датасетов с различными размера-ми и количеством классов.
    
    \textbf{Целью НИРС} является формализация подходящих метрик качества классификации и гомофи-лии, теоретическое и эмпирическое доказательство их корректности, а также сравнение разных метрик между собой и выявление лучшей. 
    
    %Для выполнения НИРС использовались следующие \textbf{методы}:
    
    В результате выполнения НИРС были получены следующие \textbf{результаты}:
    
    \begin{itemize}
    	\item Получена метрика Adjusted Homophily, обладающая лучшими свой-ствами, по сравнению с существующими классическими метриками гомофилии. 
    
    	\item Получена метрика Label Informativeness (LI), подходящая для сравнения различных датасетов 
    
    	\item В результате серии экспериментов получено, что  для  GNN метрика Label Informativeness лучше, чем гомофилия.
    	Также получено, что LI объясняет, почему GNN иногда могут хорошо работать с гетерофильными наборами дан-ных.
\end{itemize}

  
    \newpage
    
    \tableofcontents
    \pagebreak
    
    \newpage
    
	\section*{ \hfill ОБОЗНАЧЕНИЯ И СОКРАЩЕНИЯ \hfill}
	
	В работе  использованы следующие обозначения и сокращения:
	
	GNN	–	graph neural networks
	
	LI	–	Label Informativeness
	
	E	–	Ребра графа
	
	V	–	Вершины графа
	
	G	–	Граф
	
	N(v)	–	Соседи вершины v
	
	d(V)	–	Степень вершины v
	
	X\_v	–	Вектор признаков
	
	Y\_v	–	Метка класса 
	
	p(.)	–	Распределение меток класса
	
	\newpage
	
	\section*{ \hfill ВВЕДЕНИЕ \hfill}
	\addcontentsline{toc}{section}{\protect\numberline{}ВВЕДЕНИЕ}
	
	\textbf{Актуальность темы работы} обусловлена тем, что стандартные графовые нейронные сети плохо работают на негомофильных графах, однако, всё-таки могут достигать высокой производительности на некоторых графах с таким свойством.
	Поэтому важно иметь метрику, позволяющую отличать гомофильные и негомофильные случаи, так как для них требуются разные методы обучения.
	Также важно иметь метрику качества, показывающую стабильный результат на разных датасетах в разных задачах, чтобы сделать результаты интерпретируемыми и сопоставимыми. 
	
	\textbf{Целью работы} является определение метрики гомофолии графа, не зависящей от датасета и универсальной метрики качества GNN. 
	
	Для достижения поставленной цели в работе решаются следующие \textbf{основные задачи}:
	
	\begin{itemize}
		
	\item Исследование существующих метрик гомофилии и их недостатков
	
	\item Определение новой метрики гомофилии, которая закрывает недостатки классических метрик, и её теоретическое обоснование
	
	\item Определение новой метрики качества GNN, выходящей за пределы под-хода гомофилии графов, и её теоретическое обоснование
	
	\item Эмпирическое сравнение полученных метрик
	
	\end{itemize}
	
	Решение поставленных задач осуществляется с использованием следующих \textbf{методов и подходов}: для определения метрик исследованы существующие подходы оценки гомофилии:
	
	\begin{enumerate}
		\item Гомофилия рёбер
		
		\item Гомофилия вершин
		
		\item Гомофилия классов
	\end{enumerate}

	А также определены необходимые свойства: 
	
	\begin{enumerate}
		\item Maximal agreement
		
		\item Minimal agreement
		
		\item Constant baseline
		
		\item Empty class tolerance
	\end{enumerate}
	
	И введены основные понятия:
	
	\begin{enumerate}
		\item Монотонность
		
		\item Модель конфигурации
		
		\item Асимптотическое константное предсказание
	\end{enumerate}
	
	При выполнении работы использованы следующие исходные данные:
	
	\begin{enumerate}
		\item Синтетические данные, полученные с помощью stochastic block model.
		
		\item Полусинтетические данные, полученные путем добавления ребер между классами разными способами к нескольким реальным графам, что даёт несколько наборов графов с разным уровнем гомофилии.
	
		\item Синтетические данные, сгенерированные согласно подходу, описанному в статье Sitao Luan, Chenqing Hua, Qincheng Lu, Jiaqi Zhu, Mingde Zhao, Shuyuan Zhang, Xiao-Wen Chang, and Doina Precup. Is heterophily a real nightmare for graph neural networks to do node classification?
	\end{enumerate}
	
	\pagebreak
    \section{Обзор литературы и направлений исследователей}
    \setcounter{figure}{0}
    
    \subsection{Обозначения}
    
    Возьмем простой ненаправленный граф $G = (V,E)$ с вершинами $V$, ребрами $E$.
    В каждой вершине $v$ есть вектор признаков $x_v$ и метка класса $y_v$.
    Пусть $n_k$ обозначает размер класса $k$. $N(v)$ – соседи вершины $v$ в $G$, $d(v)$ – степень вершины $v$.
    За $p(.)$ примем эмпирическое распределение меток класса.
    
    \subsection{Классические меры гомофилии}
    
    Свойство гомофилии определяет то, насколько похожие вершины графа связаны. Сходство оценивается в терминах меток вершин или  их признаков.
    
    Классическими мерами гомофилии являются:

	\begin{enumerate}
		\item Гомофилия рёбер определяется как доля ребер, связывающих вершины одного класса, в общем количестве ребер 
		$$h_{edge} = \dfrac{|\{\{u,v\} \in E : y_u = y_v\}|}{|E|}$$
		
		\item Гомофилия вершин определяется как усредненная по всем вершинам доля соседей, принадлежащих одному классу, в общем количестве вершин
		$$h_{node} = \dfrac{1}{n}\sum_{v \in V}\dfrac{|\{u \in N : y_u = y_v\}|}{d(v)}$$
		
		\item Гомофилия классов измеряется как отношение гомофилии текущей модели к гомофилии нулевой модели, где ребра не зависят от меток
		$$h_{class} = \dfrac{1}{C-1}\sum_{k=1}^{C}\left[ \dfrac{\sum_{v:y_v=k}|\{u \in N(v): y_u = y_v\}|}{\sum_{v:y_v=k}d(v)} - \dfrac{n_k}{n}\right]_+$$
	\end{enumerate}
	
	Меры 1 и 2 имеют существенный недостаток – они чувствительны к балансу классов и их количеству.
	Этих недостатков нет в гомофилия классов, однако, она не учитывает изменения степеней вершин и негомофильные классы. 
	
	\pagebreak
	\section{Описание методов, предлагаемых авторами статьи, постановка задачи, новые термины}
	\setcounter{figure}{0}
	
	\subsection{Генерация синтетических данных}
	
	Для того, чтобы контролировать характеристики создаваемого графа предлагается использовать стохастическую блочную модель (SBM) \cite{holland1983stochastic}.
	Вершины в этой модели разделены на C классов.
	Любую пару вершин $i,j$ можно соединить ребром с вероятностью $p_{c(i)c(j)}$  независимо от других вершин.
	Здесь $c(i)$ соответствует классу вершины $i$ или искомой метке вершины.
	
	Возьмем  количество классов равное $C=4$, размеры классов одинаковые $l=n/4$, тогда вероятность соединения вершин $p_{i,j}$ можно записать следующим образом:
	
	$$p_{i,j} = \begin{cases}
		p_0K, & \text{если } i = j,\\
		p_1K, & \text{если } i + j = 5,\\
		p_2K, & \text{в остальных случаях},\\
	\end{cases}$$
	
	где $p_0+p_1+2p_2=1$ и $K$ положительное число.
	При этом среднее ожидаемая степень любой вершины будет равна $p_0 Kl+p_1 Kl+2p_2 Kl=Kl$.
	
	Данная модель позволяет получить граф с различными характеристиками.
	Коэффициент $p_0$ позволяет контролировать уровень гомофилии в графе, а соотношение между $p_1$ и $p_2$ позволяет влиять на LI графа.
	
	Манипуляцию характеристиками графа можно объяснить следующим образом: есть соотношение $i+j=5$, по нему ребрами соединяются пары вершин с классами (1, 4) и (2, 3).
	Тогда при $p_2=0$ и $p_1>0$, зная метки классов соседей можно точно предсказать метку текущей вершины.
	Если же есть отношение $p_1=p_2$, то сложно дать какую-либо точную информацию о метке текущей точки.
	Во время манипуляций с $p_1$ и $p_2$  на $p_0$ не накладывались дополнительные ограничения, хотя именно эта величина характеризует уровень гомофилии в создаваемом графе.
	
	Для того, чтобы определить границы характеристик, которые могут быть получены при помощи данной модели необходимо вычислить асимптотические значения.
	
	При $n \rightarrow \infty$:
	
	$$h_{adj} = \dfrac{4}{3}p_0 - \dfrac{1}{3}$$
	
	$$LI = 1 - \dfrac{H(p_0,p_1,p_2,p_2)}{\log 4}$$
	
	где $H(X) = -\sum_ix_i\log(x_i)$
	
	Получается, $h_adj$ может принимать значения от $-1/3$ до $1$, $LI$ может быть от $0$ до $1$. Если $LI=0$, тогда всегда $h_{adj}=0$; если $h_{adj}=1$ то и $LI=1$.
	Но если $LI=1$, то $h_{adj}=1$ или $h_{adj}=-1/3$.
	
	\pagebreak
	\section{Описание данных для экспериментов, результаты применения на данных, потенциал и области прикладного применения методов}
	\setcounter{figure}{0}
	
	В данном разделе исследуется взаимосвязь между характеристиками графа и качеством GNN.
	В предыдущих исследованиях было показано, что GNN способны показывать хорошее качество на не гомофильных наборах данных.
	Предполагается, что GNN могут выделять из графов более сложные отношения, чем просто гомофилию.
	При этом ожидается, что GNN будет работать до тех пор, пока окружение вершины содержит некоторую информацию о ней.
	Предлагается использовать LI для измерения информативности окружения вершин графа.
	
	Для проверки данной гипотезы были собраны различные наборы реальных данных, а также получен способ для генерации графов на основе стохастической блочной модели с предсказуемыми коэффициентами гомофилии и LI.
	
	Для генерации графов был составлено 208 различных комбинаций $p_0,p_1,p_2$ для получения различных характеристик LI и гомофилии.
	Для каждой комбинации генерировалось 10 графов, в каждом из которых по 1000 вершин со степенью 10.
	Признаки вершин брались из набора данных cora \cite{mccallum2000automating},\cite{namata2012query},\cite{sen2008collective} и \cite{yang2016revisiting}.
	Полученные графы делились на обучающую/валидационную/тестовую выборки в соотношении 50\%/25\%/25\%.
	
	В качестве GNN моделей использовались GCN \cite{kipf2016semi} и GraphSAGE \cite{hamilton2017inductive}.
	
	\subsection{Результаты работы с синтетическим наборами данных на основе стохастической блочной модели}

	На графиках (см. рисунки \ref{fig:accuracy-of-graphsage} и \ref{fig:accuracy-of-gcn}) представлено качество обученных GNN сетей.
	Каждая точка соответствует сгенерированному набору данных, при этом по оси X откладывается метрика $h_adj$, по оси Y LI, цвет отражает Accuracy полученной модели. 
	
	Разберем график с изображением качества модели GraphSAGE (см. рисунок \ref{fig:accuracy-of-graphsage}).
	По нему видно, что качество модели больше коррелирует с LI, чем с гомофилией.
	Действительно, коэффициент корреляции Спирмена между accuracy и LI равен 0.93, а между accuracy и гомофилией 0.05.
	Если показатель LI высокий, то accuracy GraphSAGE остается также высоким несмотря на отрицательный коэффициент гомофилии.
	Для модели GCN наблюдается аналогичная ситуация (см. рисунок \ref{fig:accuracy-of-gcn}).

	\begin{figure}[!tbp]
		\centering
		\begin{minipage}[b]{0.4\textwidth}
			\includegraphics[width=\textwidth]{"images/Accuracy of GraphSAGE"}
			\caption{Accuracy GraphSAGE модели на синтетических графах}
			\label{fig:accuracy-of-graphsage}
		\end{minipage}
		\hfill
		\begin{minipage}[b]{0.4\textwidth}
			\includegraphics[width=\textwidth]{"images/Accuracy of GCN"}
			\caption{Accuracy GCN модели на синтетических графах}
			\label{fig:accuracy-of-gcn}
		\end{minipage}
	\end{figure}

	\subsection{Полусинтетические данные из \cite{ma2021homophily}}
	
	В \cite{ma2021homophily} авторы выявили, что GNN показывает хорошие результаты на некоторых гетерофильных наборах данных.
	Были получены полусинтетические графы при помощи добавления межклассовых ребер согласно паттернам из реальных графов.
	Это позволило получить набор данных с графами с разными уровнями гомофилии.
	
	Для выявления причины выявленного изменения качества была обучена GraphSAGE модель на полусинтетических данных (как в \cite{ma2021homophily}) основанных на cora графе.
	Было выявлено, что модель получает хорошее качество, когда граф имеет высокий уровень LI.
	Зависимость между LI, $h_{adj}$ и accuracy показана на рисунке 4. 
	Коэффициент корреляции Спирмена между accuracy и LI равен 0.78, а между accuracy и гомофилией -0.24. 
	
	
	Аналогичный опыт был проведен для графа citeseer, график результатами приведен на рисунке \ref{fig:accuracy-of-graphsage-citeseer}.
	Коэффициент корреляции Спирмена между accuracy и LI равен 0.51, а между accuracy и гомофилией -0.54.
	
	\begin{figure}[H]
		\centering
		\begin{minipage}[b]{0.4\textwidth}
			\includegraphics[width=\textwidth]{"images/Accuracy of GraphSAGE cora"}
			\caption{Accuracy GraphSAGE модели на полусинтетическом cora наборе данных \cite{ma2021homophily}}
			\label{fig:accuracy-of-graphsage-cora}
		\end{minipage}
		\hfill
		\begin{minipage}[b]{0.4\textwidth}
			\includegraphics[width=\textwidth]{"images/Accuracy of GraphSAGE citeseer"}
			\caption{Accuracy GraphSAGE модели на полусинтетическом citeseer наборе данных \cite{ma2021homophily}}
			\label{fig:accuracy-of-graphsage-citeseer}
		\end{minipage}
	\end{figure}
	

	
	\subsection{Синтетические данные из \cite{luan2021heterophily}}
	
	В  статье \cite{luan2021heterophily} авторы также приходят к выводу, что GNN показывает хо-рошее качество на некоторых гетерофильных графах.
	Авторы исследовали зави-симость качества GNN сетей на различных уровнях гомофилии.
	Было выявлено, что график этой зависимости имеет U форму, т.е. наблюдается высокое качество GNN модели как при высоких значениях гомофилии, так и при низких.
	
	Были сгенерированы данные аналогично \cite{luan2021heterophily}. Для каждого полученного графа был рассчитан уровень LI (см. рисунок \ref{fig:label-informativeness-depending-on-edge-homophily}).
	График зависимости LI от edge homophily также имеет U форму.
	Отсюда можно сделать вывод, что GNN моде-ли из \cite{luan2021heterophily} хорошо работают при высоких значениях LI.
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.4\linewidth]{"images/Label informativeness depending on edge homophily"}
		\caption{LI в зависимости от $h_{edge}$ на синтетическом графе \cite{luan2021heterophily}}
		\label{fig:label-informativeness-depending-on-edge-homophily}
	\end{figure}
	
	
	\pagebreak
	
	\section*{ \hfill ЗАКЛЮЧЕНИЕ \hfill}
	\addcontentsline{toc}{section}{\protect\numberline{}ЗАКЛЮЧЕНИЕ}
	
    \pagebreak
    \renewcommand{\refname}{{ \hfill СПИСОК ИСПОЛЬЗОВАННЫХ ИСТОЧНИКОВ \hfill}}
    \addcontentsline{toc}{section}{\protect\numberline{}СПИСОК ИСПОЛЬЗОВАННЫХ ИСТОЧНИКОВ}
%    \bibliographystyle{unsrt}
    \selectbiblanguage{russian}
    \bibliographystyle{BibTeX-Styles/ugost2008mod}
    \bibliography{main}
    \newpage

\end{document}